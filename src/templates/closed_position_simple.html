<!DOCTYPE html>
<html>
<head>
    <title>Closed Positions</title>
</head>
<body>
    <h1>All Closed Positions</h1>

    {% for position in positions %}
        <div style="border:1px solid #ccc; padding:10px; margin-bottom:20px;">
            <h2>Closed Position #{{ loop.index }}</h2>
            <ul>
                <li>Quantity: {{ position.quantity }}</li>
                <li>Fees: ${{ position.fees }}</li>
                <li>Open Price: ${{ position.open_market_price }}</li>
                <li>Close Price: ${{ position.close_market_price }}</li>
                <li>Open Time: {{ position.open_datetime }}</li>
                <li>Close Time: {{ position.close_datetime }}</li>
                <li>Duration: {{ position.position_duration_formatted }}</li>
                <li>PnL: ${{ position.profit_and_loss }} ({{ position.profit_and_loss_percent }}%)</li>
                <li>Run-up: ${{ position.run_up }} ({{ position.run_up_pct }}%)</li>
                <li>Drawdown: ${{ position.drawdown }} ({{ position.drawdown_pct }}%)</li>
                <li>Cumulative Profit and Loss: ${{ position.cumulative_profit_and_loss }}</li>
            </ul>

            <h3>Trade Results (Sells)</h3>
            <table border="1">
                <thead>
                    <tr>
                        <th>Quantity</th>
                        <th>Entry Price</th>
                        <th>Exit Price</th>
                        <th>Entry Time</th>
                        <th>Exit Time</th>
                        <th>Fee</th>
                        <th>PnL</th>
                        <th>PnL %</th>
                        <th>Run-up</th>
                        <th>Drawdown</th>
                        <th>% of Position</th>
                    </tr>
                </thead>
                <tbody>
                    {% for trade in position.trade_results %}
                    <tr>
                        <td>{{ trade.quantity }}</td>
                        <td>{{ trade.entry_price }}</td>
                        <td>{{ trade.exit_price }}</td>
                        <td>{{ trade.entry_datetime }}</td>
                        <td>{{ trade.exit_datetime }}</td>
                        <td>{{ trade.fee }}</td>
                        <td>{{ trade.profit_and_loss }}</td>
                        <td>{{ trade.profit_and_loss_pct }}%</td>
                        <td>${{ trade.run_up_dollar }} ({{ trade.run_up_pct }}%)</td>
                        <td>${{ trade.drawdown_dollar }} ({{ trade.drawdown_pct }}%)</td>
                        <td>{{ trade.percent_of_position }}%</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endfor %}
</body>
</html>
