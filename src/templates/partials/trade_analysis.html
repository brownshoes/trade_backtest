<div class="tab-content active" id="analysis">
    <h4 class="section-title">Trade Analysis</h4>

    <div class="metric-table-wrapper">
        <table class="metric-table">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                {% for key, value in metrics.items() %}
                    {% if key not in ['overview'] %}

                    {# -------------------------------
                       Detect valid numeric & convert
                       ------------------------------- #}
                    {% if value == 'Infinity' %}
                        {% set display = '∞' %}
                    {% elif value is none or value == '' %}
                        {% set display = '—' %}
                    {% else %}
                        {% set num = value|float(false) %}

                        {% if num == 0 %}
                            {% set display = '—' %}
                        {% else %}
                            {% set rounded = num|round(2) %}

                            {# -------------------------------
                               Currency formatting for money
                               Detect percent metrics
                               ------------------------------- #}
                            {% if 'percent' in key or key.endswith('_pct') %}
                                {% set display = rounded|string + '%' %}
                            {% elif 'pnl' in key or 'profit' in key or 'drawdown' in key or 'fee' in key %}
                                {% set display = '$' + '{:,.2f}'.format(rounded) %}
                            {% else %}
                                {% set display = '{:,.2f}'.format(rounded) %}
                            {% endif %}
                        {% endif %}
                    {% endif %}

                    <tr>
                        <td class="metric-name">{{ key.replace('_', ' ').title() }}</td>
                        <td class="metric-result">{{ display }}</td>
                    </tr>

                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
